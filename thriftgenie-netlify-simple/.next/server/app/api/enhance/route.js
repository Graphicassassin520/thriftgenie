"use strict";(()=>{var e={};e.id=544,e.ids=[544],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7441:e=>{e.exports=require("sharp")},5849:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>d});var n={};r.r(n),r.d(n,{POST:()=>p,dynamic:()=>c});var s=r(9303),a=r(8716),o=r(670),i=r(7070),u=r(2040),l=r(298);let c="force-dynamic";async function p(e){let t=Date.now();try{let n=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown";if(!(0,l.Dn)(`enhance_${n}`,5,6e4))return(0,l.y8)("enhance",!1),i.NextResponse.json({error:"Rate limit exceeded. Please try again in a minute.",ai_system:"none",powered_by:"Rate Limiter"},{status:429});let{imageUrl:s,options:a,customAdjustments:o}=await e.json();if(!s||!a||"string"!=typeof s)return(0,l.y8)("enhance",!1),i.NextResponse.json({error:"Missing required fields: imageUrl and options",ai_system:"none",powered_by:"Input Validator"},{status:400});if(console.log("\uD83D\uDE80 Starting image enhancement:",{imageUrl:s.substring(0,50)+"...",options:a,customAdjustments:o}),!(0,l.Sq)(s))return(0,l.y8)("enhance",!1),i.NextResponse.json({error:"Invalid image URL format",ai_system:"none",powered_by:"URL Validator"},{status:400});console.log("\uD83D\uDDBC️ Enhancing image with real image processing...");let c=await (0,u.hF)(s,a);if(o&&(0!==o.brightness||0!==o.contrast||0!==o.saturation)){console.log("\uD83C\uDFA8 Applying custom adjustments:",o);try{let{imageEnhancementService:e}=await r.e(374).then(r.bind(r,4374)),{dataUrlToBuffer:t,bufferToDataUrl:n}=await r.e(730).then(r.bind(r,7730)),s=t(c),a=await e.applyCustomAdjustments(s,o.brightness||0,o.contrast||0,o.saturation||0);c=n(a,"image/jpeg")}catch(e){throw console.error("❌ Custom adjustments failed:",e),Error(`Custom adjustments failed: ${e.message}`)}}let p=Date.now()-t;return(0,l.y8)("enhance",!0),console.log("✅ Image enhancement completed successfully"),i.NextResponse.json({success:!0,ai_system:"Image Processing",powered_by:"Sharp Image Processing Library",data:{originalImageUrl:s,enhancedImageUrl:c,options:a,customAdjustments:o,processingTimeMs:p}})}catch(r){let e=Date.now()-t;if((0,l.y8)("enhance",!1),console.error("❌ Enhancement error:",r),r?.name==="OpenAIError"||r?.status)return(0,l.eg)(r);return i.NextResponse.json({error:`Image enhancement failed: ${r.message||"Unknown error"}. Please try again or contact support if the problem persists.`,ai_system:"Image Processing",powered_by:"Sharp Image Processing Library",error_type:"processing_error",processingTimeMs:e},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/enhance/route",pathname:"/api/enhance",filename:"route",bundlePath:"app/api/enhance/route"},resolvedPagePath:"/Users/johnstuart/Downloads/AI_Image_Analysis_for_Products/listing-optimizer/app/app/api/enhance/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:d,serverHooks:h}=m,y="/api/enhance/route";function f(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:d})}},298:(e,t,r)=>{r.d(t,{Dn:()=>a,Eg:()=>u,Sq:()=>i,eg:()=>o,y8:()=>l});var n=r(7070);let s=new Map;function a(e,t=10,r=6e4){let n=Date.now(),a=s.get(e);return!a||n>a.resetTime?(s.set(e,{count:1,resetTime:n+r}),!0):!(a.count>=t)&&(a.count++,!0)}function o(e){return(console.error("OpenAI API Error:",e),e?.status===429)?n.NextResponse.json({error:"Rate limit exceeded. Please try again later.",type:"rate_limit"},{status:429}):e?.status===401?n.NextResponse.json({error:"API authentication failed.",type:"auth_error"},{status:500}):e?.status===400?n.NextResponse.json({error:"Invalid request to AI service.",type:"bad_request"},{status:400}):n.NextResponse.json({error:"AI service temporarily unavailable. Please try again.",type:"service_error"},{status:503})}function i(e){try{let t=new URL(e);if(!["http:","https:","data:"].includes(t.protocol))return!1;if("data:"===t.protocol)return e.startsWith("data:image/");let r=t.pathname.toLowerCase(),n=t.hostname.toLowerCase();if(["images.unsplash.com","unsplash.com","imgur.com","i.imgur.com","cdn.","images."].some(e=>n.includes(e))||[".jpg",".jpeg",".png",".gif",".webp",".heic"].some(e=>r.includes(e))||e.includes("format=")||e.includes("auto=format")||e.includes("w=")||e.includes("h="))return!0;return!1}catch{return!1}}function u(e){if(!e||"object"!=typeof e)return null;let{imageUrl:t,platforms:r}=e;if(!t||"string"!=typeof t||!i(t)||!r||!Array.isArray(r)||0===r.length)return null;let n=["facebook","instagram","tiktok","poshmark","mercari","craigslist","etsy","website","x"],s=r.filter(e=>"string"==typeof e&&n.includes(e));return 0===s.length?null:{imageUrl:t.trim(),platforms:s}}function l(e,t,r){let n=new Date().toISOString();console.log(`[USAGE] ${n} - ${e}: ${t?"SUCCESS":"FAILED"}${r?` (${r} tokens)`:""}`)}setInterval(function(){let e=Date.now();for(let[t,r]of s.entries())e>r.resetTime&&s.delete(t)},3e5)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,972,991,40],()=>r(5849));module.exports=n})();